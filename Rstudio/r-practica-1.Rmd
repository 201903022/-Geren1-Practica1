---
title: "Practica 1 - Airbnb NYC 2025"
output:
  html_notebook: default
  pdf_document: default
  html_document:
    df_print: paged
---

## Parte I. Manipulación de datos con dplyr

### 1. Muestra las primeras filas y la estructura del dataset (head(), str()).
```{r}
library(readr)
library(dplyr)

df <- read_csv("listings.csv")
options(scipen=999)












head(df)
str(df)
```

### 2. Realiza una transformación para la columna price, asegurándose de quitar el carácter dólar ($) y convirtiendo toda la columna a valor numérico.
```{r}
df <- df %>%
  mutate( 
    price_num = as.numeric(gsub("[$,]", "", price))
      )
options(scipen=999)
head(select(df, price, price_num))
```

### 3. Filtra los registros para mantener solo alojamientos con más de 10 reseñas yun precio menor a $500 por noche. Además, excluye valores faltantes para la columna host_location.

```{r}
df_filtrado_top_10 <- df %>%
  filter(
    number_of_reviews > 10,
    !is.na(host_location),
    price_num < 500
  )

options(scipen=999)
head(df_filtrado_top_10)
```

### 4.Ordena los datos de mayor a menor disponibilidad (availability_365).
```{r}
df_ordenado_availability <- df_filtrado_top_10 %>%
  arrange(desc(availability_365))

options(scipen=999)
head(df_ordenado_availability)
```

### 5. Crea una nueva columna llamada total_revenue, que represente el ingreso potencial en un año (price * availability_365).

```{r}
df_nueva_columna <- df_ordenado_availability %>%
  mutate(total_revenue = price_num * availability_365)

options(scipen=999)
head(select(df_nueva_columna, price_num, availability_365, total_revenue))
```

### 6.Selecciona las columnas host_location, room_type, price, availability_365, total_revenue y number_of_reviews.
```{r}
df_final <- df_nueva_columna %>%
  select(
    host_location, room_type,
    price = price_num,
    availability_365, total_revenue,
    number_of_reviews
  )

options(scipen=999)
head(df_final)
```

---

## Parte II. Resúmenes y agrupaciones

### 1. Agrupa los datos por host_location y calcula:
- Precio promedio por noche.
- Número total de alojamientos.
- Ingreso potencial promedio (mean(total_revenue)).
```{r}
resumen_host_loc <- df_final %>%
  group_by(host_location) %>%
  summarize(
    avg_price = mean(price, na.rm = TRUE),
    total_listings = n(),
    avg_total_revenue = mean(total_revenue, na.rm = TRUE),
  ) %>%
  arrange(desc(total_listings))

options(scipen=999)
head(resumen_host_loc)
```

### Agrupa los datos por room_type dentro de cada host_location y calcular:
- Disponibilidad promedio.
```{r}
resumen_room_type <- df_final %>%
  group_by(host_location, room_type) %>%
  summarise(
    avg_availability = mean(availability_365, na.rm = TRUE),
    n = n(),
  ) %>%
  arrange(host_location, desc(avg_availability))

head(resumen_room_type)
```

---

## Parte III. Visualización de datos con ``ggplot2``

### 1. Gráfico 1. Dispersión (scatter plot)
- Crea un gráfico de dispersión donde el eje X sea el precio y el eje Y el número
de reseñas (number_of_reviews).
- Diferencia los puntos por room_type, utiliza el parámetro color en la función
aes.

```{r}
library(ggplot2)

ggplot(df_final, aes(x = price, y = number_of_reviews, color = room_type)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Precio vs Número de reseñas",
    x = "Precio por noche (USD $)",
    y = "Número de reseñas",
    color = "Tipo de alojamiento"
  ) +
  theme_minimal()+
  scale_x_log10() +
  scale_y_log10()
  
```
#### Hallazgos – Gráfico 1

- Se observa que los alojamientos con precios más bajos concentran la mayor cantidad de reseñas, lo que sugiere que son más demandados.

- A medida que el precio aumenta, el número de reseñas tiende a disminuir, indicando menor popularidad de los alojamientos más caros.

- La escala logarítmica ayuda a visualizar mejor la dispersión de datos..

### 2. Gráfico de barras (bar plot)
- Crea un gráfico con la evolución del precio promedio de los alojamientos en
función del room_type.  
- Usa geom_col(), asegurándose de que se diferencie el tipo de alojamiento con
el parámetro fill en la función aes.  

```{r}
precio_por_tipo <- df_final %>%
  group_by(room_type) %>%
  summarize(
    avg_price = mean(price, na.rm = TRUE),
    .groups = "drop"
  )

ggplot(precio_por_tipo, aes(x = room_type, y = avg_price, fill = room_type)) +
  geom_col() +
  labs(
    title = "Precio promedio por tipo de alojamiento",
    x = "Tipo de alojamiento",
    y = "Precio promedio (USD)",
    fill = "Tipo"
  ) +
  theme_minimal()
```
#### Hallazgos – Gráfico 2

- Se observa que los alojamientos completos presentan un precio promedio más alto, superior a los 100 USD por noche.

- Los Private room tienen un precio promedio significativamente menor, en torno a los 50–60 USD por noche.

- Esta diferencia muestra que el tipo de alojamiento es un factor determinante en el precio: alquilar un espacio completo implica un costo mayor que una habitación privada.


### 3. Gráfico facetado (facet_wrap)
- Crea un gráfico de dispersión donde se muestre la relación entre
disponibilidad (availability_365) y precio (price).
- Divide el gráfico en paneles por host_location usando
facet_wrap(~host_location).

```{r}
ggplot(df_final, aes(x = price, y = availability_365)) +
  geom_point(alpha = 0.6) +
  facet_wrap(~ host_location)  + #~host_location
  labs(
    title = "Disponibilidad vs Precio",
    x = "Precio por noche (USD $)",
    y = "Disponibilidad (días)"
  ) +
  theme_minimal()
```

#### Hallazgos – Gráfico 3

- El gráfico muestra cómo varía la relación entre precio y disponibilidad anual en diferentes ubicaciones.

- En Albany, NY, la mayoría de alojamientos presentan precios bajos y alta disponibilidad.

- En New York, NY, los precios son más variados, con alojamientos que alcanzan aprox. hasta los 400 USD por noche.

- En otras ubicaciones como Colonie, NY o Stamford, NY, la oferta es más reducida y dispersa, con pocos alojamientos y gran variabilidad en disponibilidad.

